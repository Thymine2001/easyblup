# easyblup 项目总结

## 项目概述

easyblup 是一个基于 R Shiny 的可视化参数文件生成器，专门用于 BLUPF90 软件。该项目通过直观的拖放界面，让用户能够轻松定义线性混合模型并自动生成相应的 renumf90 参数文件。

## 已实现功能

### ✅ 1. 基本应用框架
- 使用 `fluidPage` 和 `sidebarLayout` 创建响应式布局
- 左侧功能栏包含文件上传功能
- 右侧主面板显示模型定义和参数预览

### ✅ 2. 数据上传与处理
- 支持 CSV 格式的表型数据上传
- 可选的基因型数据上传
- 自动读取和显示列名
- 错误处理和用户提示

### ✅ 3. 可视化列名标签
- 动态生成可拖动的列名标签
- 使用 `sortable` 包实现拖放功能
- 美观的灰色圆角标签样式

### ✅ 4. 模型定义区域
- 清晰的线性混合模型公式显示：**y = Xb + Za + Wr + e**
- 四个颜色编码的拖放目标区域：
  - 🟠 **性状 (Traits)**: 橙色背景
  - 🔴 **固定效应 (Fixed Effects)**: 红色背景
  - 🟢 **动物ID (Animal ID)**: 绿色背景
  - 🔵 **其他随机效应 (Other Random Effects)**: 蓝色背景

### ✅ 5. 拖放交互功能
- 使用 `rank_list` 组件实现完整的拖放功能
- 支持从可用变量列表拖拽到模型组件
- 实时更新参数文件预览

### ✅ 6. 参数文件生成
- 实时生成 renumf90 参数文件预览
- 自动计算列号对应关系
- 支持多性状分析
- 包含完整的 BLUPF90 选项设置

## 技术特性

### 前端技术
- **R Shiny**: 主要框架
- **sortable**: 拖放交互
- **Bootstrap**: 响应式布局
- **CSS**: 自定义样式

### 后端功能
- **数据读取**: CSV 文件处理
- **列名映射**: 自动计算列号
- **参数生成**: 动态构建参数文件
- **错误处理**: 用户友好的错误提示

## 文件结构

```
easyblup/
├── app.R                 # 主应用文件
├── DESCRIPTION           # 包依赖管理
├── easyblup.Rproj       # RStudio 项目文件
├── example_data.csv     # 示例数据文件
├── README.md            # 项目说明
├── run_app.R            # 应用启动脚本
├── test_app.R           # 测试脚本
├── USAGE.md             # 详细使用说明
├── PROJECT_SUMMARY.md   # 项目总结（本文件）
└── .gitignore           # Git 忽略文件
```

## 使用方法

### 快速启动
```r
# 方法1：直接运行
shiny::runApp()

# 方法2：使用启动脚本
source("run_app.R")

# 方法3：运行测试
source("test_app.R")
```

### 基本工作流程
1. **上传数据**: 选择包含表型数据的 CSV 文件
2. **查看变量**: 系统自动显示所有列名
3. **定义模型**: 拖拽变量到相应的模型组件
4. **生成参数**: 查看实时生成的 renumf90 参数文件
5. **保存使用**: 复制参数文件内容用于 BLUPF90 分析

## 示例数据

项目包含一个示例数据文件 `example_data.csv`，包含：
- `animal_id`: 动物ID
- `herd`: 群体
- `sex`: 性别
- `age`: 年龄
- `weight`: 体重
- `milk_yield`: 产奶量
- `fat_content`: 乳脂率
- `protein_content`: 乳蛋白率

## 生成的参数文件示例

```
DATAFILE
example_data.csv

TRAITS
6 7 8

FIELDS_PASSED_TO_OUTPUT
6 7 8

WEIGHT(S)
# Add weight column if applicable

EFFECTS
2 3 4
1

RANDOM
animal

OPTION solv_method FSPAK
OPTION missing -999
OPTION maxrounds 500
OPTION conv_crit 1e-6
```

## 技术亮点

1. **直观的用户界面**: 通过颜色编码和拖放操作简化模型定义
2. **实时预览**: 参数文件随拖放操作实时更新
3. **错误处理**: 完善的错误提示和用户引导
4. **可扩展性**: 易于添加新功能和自定义选项
5. **跨平台**: 基于 Web 技术，支持各种操作系统

## 未来改进方向

1. **更多数据格式支持**: Excel、文本文件等
2. **模型验证**: 添加模型合理性检查
3. **参数模板**: 预设常用模型模板
4. **结果导出**: 支持多种格式导出
5. **用户指南**: 集成帮助文档和教程

## 依赖要求

- R >= 3.6.0
- shiny >= 1.7.0
- sortable >= 0.4.2

## 项目状态

✅ **完成**: 所有核心功能已实现并测试通过
✅ **可用**: 应用可以正常运行和使用
✅ **文档**: 完整的使用说明和测试指南

项目已准备就绪，可以立即投入使用！
